
app.controller('CentreController', ['$scope', '$http', '$timeout', '$location', 'CentreService', 'CourtService', 'NavigatorGeolocation', 'GeoCoder', function($scope, $http, $timeout, $location, CentreService, CourtService, NavigatorGeolocation, GeoCoder){
  

$http.get('/users/current_user_profile')
 .success(function(data){
 
  $scope.user = data
 })


 // passing the displayTime() function from moment.js file so we can display a clock, and including the $timeout Angular service
  var updateTime = function() {
    $scope.displayTime = displayTime();
    $timeout(function() {
      updateTime();
    }, 1000);
  }
  updateTime();

NavigatorGeolocation.getCurrentPosition()
   .then(function(position) {
    $scope.meLat = position.coords.latitude; 
    $scope.meLong = position.coords.longitude;
    $scope.me = position.coords.latitude, position.coords.longitude;
     // console.log($scope.meLat);
     // console.log($scope.meLong);

  });

  CentreService.getCentres()
  .then(function(response) {
    $scope.centres = response.data;
    });

  //   $scope.showInfoWindow = function (event, p) {

  //     var infowindow = new google.maps.InfoWindow();
  //     var center = new google.maps.LatLng(centre.latitude,centre.longitude);

  //     infowindow.setContent(
  //         '<h3>' + p + '</h3>');

  //     infowindow.setPosition(center);
  //     infowindow.open($scope.objMapa);
  //   };


// setTimeout(function(){
//   console.log($scope.centre);
// },2000);

$scope.current_user = gon.current_user

var size = 140;
setInterval(function(){
  $('.pulse').width(size).height(size);
  size++;
  if(size > 200){
    $('.pulse').css('opacity', $('.pulse').css('opacity')-0.001);
  }
  if(size > 500){
    size = 50;
  $('.pulse').width(size).height(size);
    $('.pulse').css('opacity', '0.3');
  }
},0); 

$('.photo').click(function(){
  console.log('CLick'); 
  $( ".pulse" ).clone().appendTo( "body" );
})

$('.find-court-button').click(function() {
  $('.main-page-courts').show(200);
  $('.main-challenge-info').hide(600);
  $('.map-hide').show(200);
});

$('.find-opponent-button').click(function() {
  $('.main-challenge-info').show(200);
  $('.main-page-courts').hide(700);
});

$('.launchConfirm').on('click', function (e) {
  console.log(e);
    $('#confirm')
        .modal({ backdrop: 'static', keyboard: false })
        .one('click', '[data-value]', function (e) {
            if($(this).data('value')) {
                alert('confirmed');
            } else {
                alert('canceled');
            }
        });
});

}]);



















// CentreService.getCentres()
  // .then(function(response) {
  //   $scope.centres = response.data;
  //   // console.log($scope.centre);
  // });

  // filter all the courts  

  // $scope.courts = []
  // CentreService.getCentres()
  //   .then(function(response) {
  //     $scope.centre = response.data;
  //     angular.forEach($scope.centre, function(value, key){ 
  //     $scope.courts.push(value.courts);   
  //     });
  //   $scope.allcourts = _.flatten($scope.courts)  
  //   // console.log($scope.allcourts); 
  // });


  // CourtService.getCourts()
  // .then(function(response){
  //   // console.log(response.data)
  // })

  


  // function to filter courts by availability 
  // $scope.av = []
  // CourtService.getCourts()
  // .then(function(response){
  //   // console.log(response.data)
  //   $scope.temp = response.data
  //   angular.forEach($scope.temp, function(value, key){ 
  //     // Here we create a new variable with only courts that are free
  //     if (value.availability == 'free')
  //       $scope.av.push(value);
  //   });
  //   // console.log($scope.av);
  //   angular.forEach($scope.av, function(value, key){ 
  //     // console.log(value.availability, value.centre.location, value.court_no, basicFormat(value.start_time), basicFormat(value.end_time));
  //     });
  // })




// Getting the current user id 